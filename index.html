<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Race Car Controller</title>
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <style>
        body{
            background-color: black;
            color:white;
        }
        #ball{
            position:absolute;
            border-radius: 100%;
            outline: #FFF dashed 20px;
            background: radial-gradient(#fff7a7,#ffd100);
            width: 150px;
            height: 150px;
            left: 45%;
            top: 35%;
            transition:left 0.2s linear, top 0.2s linear, transform 0.2s linear;
        }
    </style>
</head>
<body>
    <div id="report_box"></div>
    <div id="ball"></div>

    <script>
        let sensor = new Gyroscope();
        let z = 0;
        let report = "";
        let readings = []; // Array to store recent readings
        let numReadings = 10; // Adjust the number of readings for averaging
        sensor.start();

        sensor.onreading = () => {
            report = "Z-axis Angle Velocity: " + sensor.z + "<br>";
            report += "Ball current Rotation = " + z + "deg<br>";
            report_box.innerHTML = report;

            // Add the new reading to the array
            readings.push(sensor.z);

            // Ensure the array doesn't exceed the specified number of readings
            if (readings.length > numReadings) {
                readings.shift(); // Remove the oldest reading
            }

            // Calculate the average of the readings
            let averageZ = readings.reduce((sum, reading) => sum + reading, 0) / readings.length;

            // Apply damping/smoothing
            z = 0.1 * averageZ + 0.9 * z;

            ball.style.transform = "rotate(" + z * -33 + "deg)";
        };

        sensor.onerror = errorHandler;

        function errorHandler(event){
            console.log(event.error.name, event.error.message);
        }
    </script>
</body>
</html>
